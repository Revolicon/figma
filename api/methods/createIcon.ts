type IconStyle =
  | 'line'
  | 'fill'
  | 'brand'

interface IconProps {
  slug: string;
  style: IconStyle;
  version: string;
  size?: number;
  color?: string;
  overlay?: number;
}

function createIcon({
  slug,
  style,
  version,
  size = 16,
  color = "black",
  overlay = 1
}: IconProps) {
  const component = figma.createComponent()
  component.name = `Revolicon/${style}/${slug}`;

  // Create frame with overlay
  component.resizeWithoutConstraints(
    size * overlay,
    size * overlay
  )

  // Create SVG
  let iconSvg = figma.createNodeFromSvg(`<svg width="${size}" height="${size}" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M28.3546 2.10189C29.8167 0.608436 32.0352 -0.186379 34.1124 0.037268C35.5797 0.195235 36.726 0.855674 37.6898 1.60977C38.558 2.28907 39.4906 3.2207 40.4916 4.22067L54.8932 18.6041C56.0129 19.7223 56.9789 20.6871 57.7095 21.5466C58.4805 22.4537 59.1644 23.4393 59.5588 24.6514C60.1471 26.4598 60.1471 28.4079 59.5588 30.2163C59.1644 31.4284 58.4805 32.414 57.7095 33.3211C56.9789 34.1806 56.013 35.1453 54.8932 36.2636L43.6213 47.5275C44.3235 49.5585 44.0492 51.8435 42.7984 53.6762C42.4277 54.2194 41.9256 54.72 41.4493 55.195L41.3223 55.3217L41.1955 55.4488C40.7206 55.9251 40.2201 56.4271 39.677 56.7978C37.3909 58.3582 34.4009 58.3991 32.078 56.9202C32.0156 56.8805 31.9538 56.8397 31.8924 56.7978C31.3492 56.4271 30.8487 55.9251 30.3739 55.4488L30.2636 55.3383L27.5965 52.7542L23.4979 59.4148C21.7445 62.2642 18.6384 64 15.2928 64C9.05595 64 4 58.9437 4 52.7065C4 49.3607 5.73566 46.2544 8.58495 44.5009L15.2451 40.4021L12.6611 37.7347L12.5507 37.6245C12.0744 37.1496 11.5723 36.6489 11.2016 36.1057C11.1598 36.0444 11.119 35.9826 11.0793 35.9203C10.1533 34.4655 9.82319 32.7492 10.089 31.1079C10.2157 30.3251 10.478 29.5593 10.8759 28.8472C10.9759 28.6682 11.0846 28.4925 11.2017 28.3208C11.5724 27.7776 12.0744 27.2771 12.5507 26.8022L12.6777 26.6754L12.8044 26.5485C13.2794 26.072 13.7799 25.5701 14.323 25.1993C14.4946 25.0822 14.6702 24.9736 14.8492 24.8736C15.5613 24.4756 16.3271 24.2132 17.1099 24.0864C17.8418 23.9679 18.5887 23.9679 19.3207 24.0864C19.4173 24.1021 19.5136 24.1198 19.6097 24.1396C19.901 23.7896 20.2902 23.2654 20.758 22.5378C21.5176 21.3564 22.3399 19.8684 23.1133 18.2634C24.7098 14.9504 25.8807 11.5903 26.0706 9.62346L26.0854 9.47047C26.2239 8.03491 26.3521 6.70485 26.5901 5.61748C26.8527 4.41772 27.315 3.1638 28.3546 2.10189ZM50.5709 32.1003C51.7955 30.8771 52.5853 30.0851 53.138 29.4348C53.668 28.8113 53.8018 28.5178 53.8531 28.3599C54.049 27.758 54.049 27.1098 53.8531 26.5079C53.8018 26.3499 53.668 26.0564 53.138 25.4329C52.6968 24.9139 52.105 24.3049 51.2613 23.4582C49.5547 24.8358 47.7211 25.9255 46.0209 26.6898C44.2132 27.5024 42.4437 27.9978 41.0909 27.9978C40.6979 27.9978 40.3352 27.8189 40.1416 27.5295C39.948 27.2401 39.9533 26.8849 40.1555 26.5997C43.0418 22.529 44.1909 18.948 44.3453 16.5497L36.3606 8.57507C35.2129 7.42884 34.5391 6.76319 33.9927 6.33564C33.7449 6.14179 33.5996 6.05968 33.527 6.02537C33.4936 6.00961 33.4746 6.00401 33.4746 6.00401L33.4702 6.00317C33.2194 5.97616 32.8193 6.11978 32.6432 6.29833C32.6432 6.29833 32.6317 6.31636 32.6171 6.34755C32.5817 6.4232 32.5205 6.58433 32.4514 6.90033C32.2996 7.59405 32.2013 8.55928 32.0429 10.2002C31.7468 13.266 30.1824 17.4153 28.5184 20.8683C27.6616 22.6464 26.7225 24.3555 25.8049 25.7828C25.4271 26.3705 25.0199 26.9634 24.5927 27.515L39.8702 42.7934L50.5709 32.1003ZM37.7407 50.4064C37.8082 50.3328 37.8422 50.2913 37.8533 50.2775C38.0489 49.9775 38.0489 49.5901 37.8533 49.2901C37.8423 49.2764 37.8082 49.2349 37.7407 49.1612C37.6155 49.0246 37.467 48.8751 37.2129 48.6218L19.3791 30.7869C19.1259 30.5329 18.9744 30.3824 18.8378 30.2572C18.7642 30.1897 18.7227 30.1556 18.7089 30.1445C18.4089 29.949 18.0216 29.949 17.7217 30.1445C17.7079 30.1556 17.6664 30.1897 17.5927 30.2573C17.4561 30.3825 17.3066 30.531 17.0532 30.7852L16.9162 30.9225L16.7892 31.0493C16.5351 31.3026 16.3845 31.4541 16.2594 31.5907C16.1919 31.6643 16.1578 31.7058 16.1467 31.7196C15.9511 32.0197 15.9513 32.4072 16.1466 32.707C16.1577 32.7207 16.1918 32.7623 16.2594 32.836C16.3846 32.9726 16.5331 33.1221 16.7871 33.3754L16.899 33.4871L16.9704 33.5595L19.5544 36.2269C20.8202 37.5335 21.4249 39.3438 21.1985 41.1489C20.9721 42.954 19.939 44.5589 18.3897 45.5123L11.7295 49.6112C10.6548 50.2726 10 51.4444 10 52.7065C10 55.6298 12.3697 57.9996 15.2928 57.9996C16.5549 57.9996 17.7265 57.3448 18.3879 56.27L22.4865 49.6094C23.4399 48.06 25.0447 47.0269 26.8497 46.8005C28.6546 46.574 30.4649 47.1787 31.7714 48.4446L34.4385 51.0287L34.511 51.1001L34.6212 51.2106C34.8745 51.4646 35.0255 51.6147 35.1621 51.7399C35.2358 51.8074 35.2773 51.8415 35.291 51.8526C35.5908 52.048 35.9783 52.0481 36.2784 51.8526C36.2922 51.8414 36.3337 51.8074 36.4073 51.7399C36.5439 51.6147 36.6954 51.4641 36.9487 51.2101L37.0837 51.0747L37.2108 50.948C37.4648 50.6946 37.6155 50.543 37.7407 50.4064Z" fill="${color}"/></svg>`);
  let iconSpace = ((size * overlay) - size) / 2;
  component.appendChild(iconSvg)

  iconSvg.x = iconSpace
  iconSvg.y = iconSpace

  // Create right-bar button
  component.setRelaunchData({
    open: `See detail ${slug} icon`
  })

  // TODO: set used plugin and icon version
  component.setPluginData("revolicon", "1.0.0")
  component.setPluginData("icon_version", version)
  component.setPluginData("icon_slug", slug)
  component.setPluginData("icon_style", style)

  // Test
  const nodes = figma.root.findAll(n => {
    let nodeType = n.type === "COMPONENT";
    let nodeData = n.getPluginDataKeys().includes("revolicon");

    return nodeType && nodeData;
  })
  // console.log(nodes);
  console.log(nodes.map(l => l.getPluginData("icon_slug")));
}

export default createIcon;
